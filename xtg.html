<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="–≤—Å–µ —Å–∞–º–æ–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ">
  <meta name="keywords" content="–≤—Å–µ —Å–∞–º–æ–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ">
  <title>nkego</title>
  <script src="https://cdn.jsdelivr.net/npm/react@18.3.1/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18.3.1/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.25.6/babel.min.js"></script>
  <script src="https://telegram.org/js/telegram-web-app.js?58"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          animation: {
            'pulse': 'pulse 1s ease-out',
            'slide-up': 'slideUp 0.5s ease-out',
            'wave-in': 'waveIn 0.4s ease-out forwards',
            'shake': 'shake 0.5s ease-in-out',
            'slide-in': 'slideIn 0.4s ease-out',
            'clear-pulse': 'clearPulse 0.3s ease-in-out',
            'fade-out': 'fadeOut 0.3s ease-out forwards'
          },
          keyframes: {
            pulse: {
              '0%': { opacity: '0', transform: 'scale(0.95) translateY(-20px)' },
              '50%': { transform: 'scale(1.05)' },
              '100%': { opacity: '1', transform: 'scale(1) translateY(0)' }
            },
            slideUp: {
              '0%': { opacity: '0', transform: 'translateY(20px)' },
              '100%': { opacity: '1', transform: 'translateY(0)' }
            },
            waveIn: {
              '0%': { opacity: '0', transform: 'translateX(-10px) rotateY(30deg)' },
              '100%': { opacity: '1', transform: 'translateX(0) rotateY(0)' }
            },
            shake: {
              '0%, 100%': { transform: 'translateX(0)' },
              '20%': { transform: 'translateX(-10px) rotate(-2deg)' },
              '40%': { transform: 'translateX(10px) rotate(2deg)' },
              '60%': { transform: 'translateX(-5px) rotate(-1deg)' },
              '80%': { transform: 'translateX(5px) rotate(1deg)' }
            },
            slideIn: {
              '0%': { opacity: '0', transform: 'translateY(10px)' },
              '100%': { opacity: '1', transform: 'translateY(0)' }
            },
            clearPulse: {
              '0%': { transform: 'translateY(-50%) scale(1)', opacity: '0.7' },
              '50%': { transform: 'translateY(-50%) scale(1.2)', opacity: '1' },
              '100%': { transform: 'translateY(-50%) scale(1)', opacity: '0.7' }
            },
            fadeOut: {
              '0%': { opacity: '1', transform: 'scale(1)' },
              '100%': { opacity: '0', transform: 'scale(0.95)' }
            }
          }
        }
      }
    };
  </script>
  <style>
    body {
      padding: var(--tg-safe-area-inset-top, 0) var(--tg-safe-area-inset-right, 0)
              var(--tg-safe-area-inset-bottom, 0) var(--tg-safe-area-inset-left, 0);
    }
    @keyframes fadeIn {
      0% { opacity: 0; transform: translateY(-50px) scale(0.8); }
      100% { opacity: 1; transform: translateY(0) scale(1); }
    }
    @keyframes quoteFadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .cat-content, .quote-content, .countries-content {
      position: fixed;
      top: var(--tg-safe-area-inset-top, 0);
      left: var(--tg-safe-area-inset-left, 0);
      width: calc(100vw - var(--tg-safe-area-inset-left, 0) - var(--tg-safe-area-inset-right, 0));
      height: calc(100vh - var(--tg-safe-area-inset-top, 0) - var(--tg-safe-area-inset-bottom, 0));
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      overflow: auto;
      opacity: 0;
      transform: scale(0.8);
      transition: opacity 0.5s ease, transform 0.5s ease;
      padding: 10px;
    }
    .cat-content.show, .quote-content.show, .countries-content.show {
      opacity: 1;
      transform: scale(1);
    }
    .cat-top-strip, .cat-bottom-strip, .quote-top-strip, .quote-bottom-strip, .countries-top-strip, .countries-bottom-strip {
      position: absolute;
      left: 0;
      width: 100%;
      height: var(--tg-safe-area-inset-top, 10px);
      z-index: 10;
    }
    .cat-top-strip, .quote-top-strip, .countries-top-strip {
      top: 0;
    }
    .cat-bottom-strip, .quote-bottom-strip, .countries-bottom-strip {
      bottom: 0;
      height: var(--tg-safe-area-inset-bottom, 10px);
    }
    .cat-image {
      width: 100%;
      max-width: 100%;
      max-height: 400px;
      height: auto;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }
    .cat-fact {
      margin-top: 10px;
      font-size: 16px;
      text-align: center;
      max-width: 600px;
      padding: 0 10px;
    }
    .quote-slide {
      animation: quoteFadeIn 0.5s ease-in-out;
      animation-fill-mode: forwards;
    }
    .spin {
      animation: spin 1s linear infinite;
    }
    .cat-button, .back-button, .telegram-link, .quote-button, .prev-quote-button, .countries-back-button {
      padding: 15px 30px;
      font-size: 18px;
      cursor: pointer;
      border: none;
      border-radius: 5px;
      transition: transform 0.2s, background-color 0.3s, color 0.3s;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }
    .quote-back-button, .countries-back-button {
      padding: 10px 60px;
      font-size: 18px;
      cursor: pointer;
      border: none;
      border-radius: 5px;
      transition: transform 0.2s, background-color 0.3s, color 0.3s;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }
    .button-container {
      position: fixed;
      bottom: calc(20px + var(--tg-safe-area-inset-bottom, 0));
      display: flex;
      gap: 10px;
    }
    .quote-button-container, .countries-button-container {
      position: fixed;
      bottom: calc(20px + var(--tg-safe-area-inset-bottom, 0));
      display: flex;
      justify-content: center;
      width: 100%;
    }
    .telegram-link {
      position: fixed;
      bottom: calc(20px + var(--tg-safe-area-inset-bottom, 0));
      right: calc(20px + var(--tg-safe-area-inset-right, 0));
      font-size: 16px;
      padding: 10px 20px;
      background: transparent;
    }
    .cat-button:hover, .back-button:hover, .telegram-link:hover, .quote-button:hover, .prev-quote-button:hover, .quote-back-button:hover, .countries-back-button:hover {
      transform: scale(1.1);
    }
    :root {
      --input-bg: #ffffff;
      --input-border: #d1d5db;
      --button-bg: #3390ec;
      --button-text: #ffffff;
      --button-hover: #2563eb;
      --suggestions-bg: #ffffff;
      --suggestions-border: #d1d5db;
      --suggestions-hover: #f3f4f6;
      --theme-button-bg: #e5e7eb;
      --theme-button-text: #374151;
      --error-text: #ef4444;
      --success-text: #10b981;
      --quiz-button-bg: #3390ec;
      --quiz-button-hover: #2563eb;
      --quiz-button-active: #1e40af;
      --quiz-correct-bg: #10b981;
      --quiz-incorrect-bg: #ef4444;
      transition: all 0.3s ease;
    }
    input::placeholder {
      color: var(--text-color);
      opacity: 0.6;
    }
    #suggestions li {
      transition: background-color 0.2s ease, transform 0.2s ease;
      animation-delay: calc(var(--index) * 0.1s);
      background-color: var(--suggestions-bg);
    }
    #suggestions li:hover {
      transform: scale(1.03) translateX(5px);
      background-color: var(--suggestions-hover);
    }
    #countryInput {
      background-color: var(--input-bg);
      border-color: var(--input-border);
      color: var(--text-color);
    }
    #suggestions {
      background-color: var(--suggestions-bg);
      border-color: var(--suggestions-border);
    }
    #result.error {
      color: var(--error-text);
      animation: shake 0.5s ease-in-out;
    }
    #langToggle {
      background-color: var(--theme-button-bg);
      color: var(--theme-button-text);
    }
    #langToggle:hover {
      background-color: var(--button-hover);
      color: var(--button-text);
    }
    #langToggle:active {
      transform: scale(0.95);
    }
    #countryInfo {
      background-color: var(--suggestions-bg);
      border-color: var(--suggestions-border);
    }
    #result img, #quizQuestion img, #flagQuizQuestion img {
      width: 24px;
      height: 24px;
      object-fit: contain;
    }
    #clearInput {
      position: absolute;
      right: 8px;
      top: 50%;
      transform: translateY(-50%);
      background-color: var(--input-bg);
      color: var(--text-color);
      width: 24px;
      height: 24px;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      opacity: 0.7;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    #clearInput:hover {
      opacity: 1;
      background-color: var(--suggestions-hover);
    }
    #clearInput.hidden {
      display: none;
    }
    .tab {
      background-color: var(--theme-button-bg);
      color: var(--theme-button-text);
      padding: 0.5rem 1rem;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.2s ease, transform 0.2s ease;
    }
    .tab:hover {
      background-color: var(--button-hover);
      color: var(--button-text);
    }
    .tab.active {
      background-color: var(--button-bg);
      color: var(--button-text);
    }
    .quiz-option {
      background-color: var(--quiz-button-bg);
      color: var(--button-text);
      padding: 0.75rem;
      border-radius: 8px;
      width: 100%;
      text-align: center;
      transition: background-color 0.2s ease, transform 0.2s ease;
    }
    .quiz-option:hover:not(:disabled) {
      background-color: var(--quiz-button-hover);
      transform: scale(1.03);
    }
    .quiz-option:active:not(:disabled) {
      background-color: var(--quiz-button-active);
      transform: scale(0.95);
    }
    .quiz-option.correct {
      background-color: var(--quiz-correct-bg);
      color: var(--button-text);
    }
    .quiz-option.incorrect {
      background-color: var(--quiz-incorrect-bg);
      color: var(--button-text);
    }
    .next-button {
      animation: pulse 0.5s ease-out;
    }
    #quizScore, #flagQuizScore {
      background-color: var(--suggestions-bg);
      border: 1px solid var(--suggestions-border);
      border-radius: 8px;
      padding: 0.75rem;
      text-align: center;
      font-weight: 500;
    }
    #quizOptions.fade-out, #flagQuizOptions.fade-out {
      animation: fade-out 0.3s ease-out forwards;
    }
    #errorBoundary {
      background-color: var(--suggestions-bg);
      border: 1px solid var(--error-text);
      border-radius: 8px;
      padding: 1rem;
      text-align: center;
      color: var(--error-text);
    }
    @media (max-width: 600px) {
      .container {
        padding: 0.5rem;
      }
    }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/javascript">
    var gk_isXlsx = false;
    var gk_xlsxFileLookup = {};
    var gk_fileData = {};
    function filledCell(cell) {
      return cell !== '' && cell != null;
    }
    function loadFileData(filename) {
      if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
        try {
          var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
          var firstSheetName = workbook.SheetNames[0];
          var worksheet = workbook.Sheets[firstSheetName];
          var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
          var filteredData = jsonData.filter(row => row.some(filledCell));
          var headerRowIndex = filteredData.findIndex((row, index) =>
            row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
          );
          if (headerRowIndex === -1 || headerRowIndex > 25) {
            headerRowIndex = 0;
          }
          var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex));
          csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
          return csv;
        } catch (e) {
          console.error(e);
          return "";
        }
      }
      return gk_fileData[filename] || "";
    }
  </script>
  <script type="text/babel">
    const { useState, useEffect } = React;

    const buttons = [
      { name: "–¶–∏—Ç–∞—Ç—ã", url: null },
      { name: "–ö–æ—Ç–∏–∫–∏", url: null },
      { name: "–°—Ç—Ä–∞–Ω—ã", url: null },
      { name: "–†–µ–≥–∏–æ–Ω—ã", url: "https://nkego.github.io/s/r.html" },
      { name: "IP –∞–¥—Ä–µ—Å", url: "https://nkego.github.io/s/ip.html" },
    ];

    const catFacts = [
      "–ö–æ—à–∫–∏ –º–æ–≥—É—Ç –ø—Ä—ã–≥–∞—Ç—å –Ω–∞ –≤—ã—Å–æ—Ç—É, –ø—Ä–µ–≤—ã—à–∞—é—â—É—é –∏—Ö —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π —Ä–æ—Å—Ç –≤ –ø—è—Ç—å —Ä–∞–∑.",
    ];

    const countries = {
      "–†–æ—Å—Å–∏—è": {
        capital: "–ú–æ—Å–∫–≤–∞",
        code: "ru",
        en: "Russia",
        enCapital: "Moscow",
        region: "–ï–≤—Ä–æ–ø–∞",
        population: "12,600,000",
        language: "–†—É—Å—Å–∫–∏–π"
      },
      "–§—Ä–∞–Ω—Ü–∏—è": {
        capital: "–ü–∞—Ä–∏–∂",
        code: "fr",
        en: "France",
        enCapital: "Paris",
        region: "–ï–≤—Ä–æ–ø–∞",
        population: "2,165,000",
        language: "–§—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π"
      },
      "–°–®–ê": {
        capital: "–í–∞—à–∏–Ω–≥—Ç–æ–Ω",
        code: "us",
        en: "United States",
        enCapital: "Washington, D.C.",
        region: "–°–µ–≤–µ—Ä–Ω–∞—è –ê–º–µ—Ä–∏–∫–∞",
        population: "705,749",
        language: "–ê–Ω–≥–ª–∏–π—Å–∫–∏–π"
      }
    };

    const ErrorBoundary = ({ children }) => {
      const [hasError, setHasError] = useState(false);
      const [error, setError] = useState(null);

      useEffect(() => {
        const errorHandler = (error, errorInfo) => {
          console.error('ErrorBoundary caught error:', error, errorInfo);
          setHasError(true);
          setError(error);
        };
        window.addEventListener('error', errorHandler);
        return () => window.removeEventListener('error', errorHandler);
      }, []);

      if (hasError) {
        return (
          <div id="errorBoundary">
            Something went wrong. Please check the console and try again.
          </div>
        );
      }
      return children;
    };

    const SearchTab = ({ lang, result, setResult, countryInfo, setCountryInfo, countryInput, setCountryInput, suggestions, setSuggestions }) => {
      const tg = window.Telegram?.WebApp;

      const handleInput = (e) => {
        try {
          const input = e.target.value;
          setCountryInput(input);
          if (input.length < 2) {
            setSuggestions([]);
            return;
          }
          const matches = Object.keys(countries)
            .filter(country =>
              (lang === 'ru' ? country : countries[country].en)
                .toLowerCase()
                .includes(input.toLowerCase())
            )
            .slice(0, 5);
          setSuggestions(matches);
        } catch (error) {
          console.error('Error in handleInput:', error);
        }
      };

      const handleSuggestionClick = (country) => {
        try {
          setCountryInput(lang === 'ru' ? country : countries[country].en);
          setSuggestions([]);
          findCapital(country);
        } catch (error) {
          console.error('Error in handleSuggestionClick:', error);
        }
      };

      const findCapital = (input) => {
        try {
          setResult(null);
          setCountryInfo(null);
          const countryKey = Object.keys(countries).find(
            key =>
              key.toLowerCase() === input.toLowerCase() ||
              countries[key].en.toLowerCase() === input.toLowerCase()
          );

          if (countryKey) {
            const country = countries[countryKey];
            const flag = `https://flagcdn.com/96x72/${country.code}.png`;
            const capital = lang === 'ru' ? country.capital : country.enCapital;
            setResult({ flag, capital, error: false });
            setCountryInfo({
              region: country.region,
              population: country.population,
              language: country.language
            });
            if (tg?.showAlert) {
              tg.showAlert(`${lang === 'ru' ? '–°—Ç–æ–ª–∏—Ü–∞ –Ω–∞–π–¥–µ–Ω–∞' : 'Capital found'}: ${capital}`);
            } else {
              alert(`${lang === 'ru' ? '–°—Ç–æ–ª–∏—Ü–∞ –Ω–∞–π–¥–µ–Ω–∞' : 'Capital found'}: ${capital}`);
            }
          } else {
            setResult({ error: true, message: lang === 'ru' ? '–°—Ç—Ä–∞–Ω–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞' : 'Country not found' });
            if (tg?.showAlert) {
              tg.showAlert(lang === 'ru' ? '–°—Ç—Ä–∞–Ω–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞' : 'Country not found');
            } else {
              alert(lang === 'ru' ? '–°—Ç—Ä–∞–Ω–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞' : 'Country not found');
            }
          }
        } catch (error) {
          console.error('Error in findCapital:', error);
          setResult({ error: true, message: 'Error processing request' });
          if (tg?.showAlert) {
            tg.showAlert('Error processing request');
          } else {
            alert('Error processing request');
          }
        }
      };

      const clearInput = () => {
        try {
          setCountryInput('');
          setResult(null);
          setCountryInfo(null);
          setSuggestions([]);
        } catch (error) {
          console.error('Error in clearInput:', error);
        }
      };

      return (
        <div id="searchContainer">
          <div className="relative">
            <input
              id="countryInput"
              placeholder={lang === 'ru' ? '–í–≤–µ–¥–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É' : 'Enter country'}
              value={countryInput}
              onChange={handleInput}
              onKeyPress={(e) => e.key === 'Enter' && findCapital(countryInput)}
              className="w-full p-2 rounded-lg border bg-[var(--input-bg)] border-[var(--input-border)] text-[var(--text-color)]"
            />
            <button
              id="clearInput"
              className={`absolute right-2 top-1/2 transform -translate-y-1/2 ${countryInput ? '' : 'hidden'}`}
              onClick={clearInput}
            >
              √ó
            </button>
            <ul
              id="suggestions"
              className={`absolute w-full rounded-lg mt-1 max-h-40 overflow-y-auto border bg-[var(--suggestions-bg)] border-[var(--suggestions-border)] ${suggestions.length ? '' : 'hidden'}`}
            >
              {suggestions.map((country, index) => (
                <li
                  key={country}
                  className="p-2 cursor-pointer animate-wave-in"
                  style={{ '--index': index }}
                  onClick={() => handleSuggestionClick(country)}
                >
                  {lang === 'ru' ? country : countries[country].en}
                </li>
              ))}
            </ul>
          </div>
          <button
            id="findButton"
            className="mt-2 w-full p-2 rounded-lg bg-[var(--button-bg)] text-[var(--button-text)]"
            onClick={() => findCapital(countryInput)}
          >
            {lang === 'ru' ? '–ù–∞–π—Ç–∏ —Å—Ç–æ–ª–∏—Ü—É' : 'Find Capital'}
          </button>
          {result && (
            <div id="result" className={`mt-4 text-center flex items-center justify-center gap-2 ${result.error ? 'error' : 'animate-slide-in'}`}>
              {!result.error && <img src={result.flag} alt="Flag" className="w-6 h-6" />}
              <span>{result.error ? result.message : `${lang === 'ru' ? '–°—Ç–æ–ª–∏—Ü–∞' : 'Capital'}: ${result.capital}`}</span>
            </div>
          )}
          {countryInfo && (
            <div id="countryInfo" className="mt-2 p-2 rounded-lg border bg-[var(--suggestions-bg)] border-[var(--suggestions-border)] animate-slide-in">
              <p>{`${lang === 'ru' ? '–†–µ–≥–∏–æ–Ω' : 'Region'}: ${countryInfo.region}`}</p>
              <p>{`${lang === 'ru' ? '–ù–∞—Å–µ–ª–µ–Ω–∏–µ' : 'Population'}: ${countryInfo.population}`}</p>
              <p>{`${lang === 'ru' ? '–Ø–∑—ã–∫' : 'Language'}: ${countryInfo.language}`}</p>
            </div>
          )}
        </div>
      );
    };

    const QuizTab = ({ lang, correctAnswers, incorrectAnswers, setCorrectAnswers, setIncorrectAnswers }) => {
      const [quizQuestion, setQuizQuestion] = useState(null);
      const [quizOptions, setQuizOptions] = useState([]);
      const [showNext, setShowNext] = useState(false);
      const [isTransitioning, setIsTransitioning] = useState(false);
      const tg = window.Telegram?.WebApp;

      const startQuiz = () => {
        try {
          setIsTransitioning(true);
          setQuizQuestion(null);
          setQuizOptions([]);
          setShowNext(false);
          const countryKeys = Object.keys(countries);
          if (countryKeys.length < 2) {
            setQuizQuestion({ error: true, message: lang === 'ru' ? '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ç—Ä–∞–Ω' : 'Not enough countries' });
            if (tg?.showAlert) {
              tg.showAlert(lang === 'ru' ? '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ç—Ä–∞–Ω' : 'Not enough countries');
            } else {
              alert(lang === 'ru' ? '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ç—Ä–∞–Ω' : 'Not enough countries');
            }
            setIsTransitioning(false);
            return;
          }

          const randomCountry = countryKeys[Math.floor(Math.random() * countryKeys.length)];
          const country = countries[randomCountry];
          const flag = `https://flagcdn.com/96x72/${country.code}.png`;
          const correctCapital = lang === 'ru' ? country.capital : country.enCapital;

          setQuizQuestion({ flag, country: lang === 'ru' ? randomCountry : country.en });

          const allCapitals = countryKeys.map(key => lang === 'ru' ? countries[key].capital : countries[key].enCapital);
          const wrongCapitals = allCapitals
            .filter(capital => capital !== correctCapital)
            .sort(() => Math.random() - 0.5)
            .slice(0, 1);
          const options = [correctCapital, ...wrongCapitals].sort(() => Math.random() - 0.5);
          setQuizOptions(options.map(option => ({ text: option, correct: option === correctCapital })));
          setTimeout(() => setIsTransitioning(false), 400);
        } catch (error) {
          console.error('Error in startQuiz:', error);
          setQuizQuestion({ error: true, message: 'Error starting quiz' });
          setIsTransitioning(false);
          if (tg?.showAlert) {
            tg.showAlert('Error starting quiz');
          } else {
            alert('Error starting quiz');
          }
        }
      };

      const checkAnswer = (selected) => {
        try {
          setQuizOptions(prev =>
            prev.map(option => ({
              ...option,
              disabled: true,
              className: option.text === selected ? (option.correct ? 'correct' : 'incorrect') : (option.correct ? 'correct' : '')
            }))
          );
          if (selected === quizOptions.find(opt => opt.correct).text) {
            setCorrectAnswers(prev => {
              const newCount = prev + 1;
              localStorage.setItem('correctAnswers', newCount);
              return newCount;
            });
            if (tg?.showAlert) {
              tg.showAlert(lang === 'ru' ? '–ü—Ä–∞–≤–∏–ª—å–Ω–æ!' : 'Correct!');
            } else {
              alert(lang === 'ru' ? '–ü—Ä–∞–≤–∏–ª—å–Ω–æ!' : 'Correct!');
            }
          } else {
            setIncorrectAnswers(prev => {
              const newCount = prev + 1;
              localStorage.setItem('incorrectAnswers', newCount);
              return newCount;
            });
            if (tg?.showAlert) {
              tg.showAlert(lang === 'ru' ? '–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ!' : 'Incorrect!');
            } else {
              alert(lang === 'ru' ? '–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ!' : 'Incorrect!');
            }
          }
          setShowNext(true);
        } catch (error) {
          console.error('Error in checkAnswer:', error);
          if (tg?.showAlert) {
            tg.showAlert('Error processing answer');
          } else {
            alert('Error processing answer');
          }
        }
      };

      useEffect(() => {
        startQuiz();
      }, [lang]);

      return (
        <div id="quizContainer">
          <div id="quizScore" className="text-center mb-2 p-2 rounded-lg border bg-[var(--suggestions-bg)] border-[var(--suggestions-border)]">
            {lang === 'ru'
              ? `–ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö: ${correctAnswers}, –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö: ${incorrectAnswers}`
              : `Correct: ${correctAnswers}, Incorrect: ${incorrectAnswers}`}
          </div>
          {quizQuestion && (
            <div id="quizQuestion" className={`text-center flex items-center justify-center gap-2 mb-2 ${quizQuestion.error ? 'error' : 'animate-slide-in'}`}>
              {!quizQuestion.error && <img src={quizQuestion.flag} alt="Flag" className="w-6 h-6" />}
              <span>{quizQuestion.error ? quizQuestion.message : `${lang === 'ru' ? '–ù–∞–∑–æ–≤–∏ —Å—Ç–æ–ª–∏—Ü—É' : 'Name the capital'}: ${quizQuestion.country}`}</span>
            </div>
          )}
          <div id="quizOptions" className={`grid gap-2 ${showNext ? 'fade-out' : ''}`}>
            {quizOptions.map(option => (
              <button
                key={option.text}
                className={`quiz-option ${option.className || ''}`}
                onClick={() => checkAnswer(option.text)}
                disabled={option.disabled || isTransitioning}
              >
                {option.text}
              </button>
            ))}
          </div>
          <div className="flex gap-2 mt-2">
            {showNext && (
              <button
                id="nextQuestion"
                className="w-full p-2 rounded-lg bg-[var(--button-bg)] text-[var(--button-text)] next-button"
                onClick={startQuiz}
                disabled={isTransitioning}
              >
                {lang === 'ru' ? '–°–ª–µ–¥—É—é—â–∏–π' : 'Next'}
              </button>
            )}
            <button
              id="resetQuiz"
              className="w-full p-2 rounded-lg bg-[var(--button-bg)] text-[var(--button-text)]"
              onClick={() => {
                setCorrectAnswers(0);
                setIncorrectAnswers(0);
                localStorage.setItem('correctAnswers', 0);
                localStorage.setItem('incorrectAnswers', 0);
                startQuiz();
              }}
            >
              {lang === 'ru' ? '–°–±—Ä–æ—Å–∏—Ç—å' : 'Reset'}
            </button>
          </div>
        </div>
      );
    };

    const FlagQuizTab = ({ lang, flagCorrectAnswers, flagIncorrectAnswers, setFlagCorrectAnswers, setFlagIncorrectAnswers }) => {
      const [flagQuizQuestion, setFlagQuizQuestion] = useState(null);
      const [flagQuizOptions, setFlagQuizOptions] = useState([]);
      const [showNext, setShowNext] = useState(false);
      const [isTransitioning, setIsTransitioning] = useState(false);
      const tg = window.Telegram?.WebApp;

      const startFlagQuiz = () => {
        try {
          setIsTransitioning(true);
          setFlagQuizQuestion(null);
          setFlagQuizOptions([]);
          setShowNext(false);
          const countryKeys = Object.keys(countries);
          if (countryKeys.length < 2) {
            setFlagQuizQuestion({ error: true, message: lang === 'ru' ? '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ç—Ä–∞–Ω' : 'Not enough countries' });
            if (tg?.showAlert) {
              tg.showAlert(lang === 'ru' ? '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ç—Ä–∞–Ω' : 'Not enough countries');
            } else {
              alert(lang === 'ru' ? '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ç—Ä–∞–Ω' : 'Not enough countries');
            }
            setIsTransitioning(false);
            return;
          }

          const randomCountry = countryKeys[Math.floor(Math.random() * countryKeys.length)];
          const country = countries[randomCountry];
          const flag = `https://flagcdn.com/96x72/${country.code}.png`;
          const correctCountry = lang === 'ru' ? randomCountry : country.en;

          setFlagQuizQuestion({ flag });

          const allCountries = countryKeys.map(key => lang === 'ru' ? key : countries[key].en);
          const wrongCountries = allCountries
            .filter(c => c !== correctCountry)
            .sort(() => Math.random() - 0.5)
            .slice(0, 1);
          const options = [correctCountry, ...wrongCountries].sort(() => Math.random() - 0.5);
          setFlagQuizOptions(options.map(option => ({ text: option, correct: option === correctCountry })));
          setTimeout(() => setIsTransitioning(false), 400);
        } catch (error) {
          console.error('Error in startFlagQuiz:', error);
          setFlagQuizQuestion({ error: true, message: 'Error starting flag quiz' });
          setIsTransitioning(false);
          if (tg?.showAlert) {
            tg.showAlert('Error starting flag quiz');
          } else {
            alert('Error starting flag quiz');
          }
        }
      };

      const checkAnswer = (selected) => {
        try {
          setFlagQuizOptions(prev =>
            prev.map(option => ({
              ...option,
              disabled: true,
              className: option.text === selected ? (option.correct ? 'correct' : 'incorrect') : (option.correct ? 'correct' : '')
            }))
          );
          if (selected === flagQuizOptions.find(opt => opt.correct).text) {
            setFlagCorrectAnswers(prev => {
              const newCount = prev + 1;
              localStorage.setItem('flagCorrectAnswers', newCount);
              return newCount;
            });
            if (tg?.showAlert) {
              tg.showAlert(lang === 'ru' ? '–ü—Ä–∞–≤–∏–ª—å–Ω–æ!' : 'Correct!');
            } else {
              alert(lang === 'ru' ? '–ü—Ä–∞–≤–∏–ª—å–Ω–æ!' : 'Correct!');
            }
          } else {
            setFlagIncorrectAnswers(prev => {
              const newCount = prev + 1;
              localStorage.setItem('flagIncorrectAnswers', newCount);
              return newCount;
            });
            if (tg?.showAlert) {
              tg.showAlert(lang === 'ru' ? '–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ!' : 'Incorrect!');
            } else {
              alert(lang === 'ru' ? '–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ!' : 'Incorrect!');
            }
          }
          setShowNext(true);
        } catch (error) {
          console.error('Error in checkAnswer:', error);
          if (tg?.showAlert) {
            tg.showAlert('Error processing answer');
          } else {
            alert('Error processing answer');
          }
        }
      };

      useEffect(() => {
        startFlagQuiz();
      }, [lang]);

      return (
        <div id="flagQuizContainer">
          <div id="flagQuizScore" className="text-center mb-2 p-2 rounded-lg border bg-[var(--suggestions-bg)] border-[var(--suggestions-border)]">
            {lang === 'ru'
              ? `–ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö: ${flagCorrectAnswers}, –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö: ${flagIncorrectAnswers}`
              : `Correct: ${flagCorrectAnswers}, Incorrect: ${flagIncorrectAnswers}`}
          </div>
          {flagQuizQuestion && (
            <div id="flagQuizQuestion" className={`text-center flex items-center justify-center gap-2 mb-2 ${flagQuizQuestion.error ? 'error' : 'animate-slide-in'}`}>
              {!flagQuizQuestion.error && <img src={flagQuizQuestion.flag} alt="Flag" className="w-6 h-6" />}
              <span>{flagQuizQuestion.error ? flagQuizQuestion.message : (lang === 'ru' ? '–ù–∞–∑–æ–≤–∏ —Å—Ç—Ä–∞–Ω—É' : 'Name the country')}</span>
            </div>
          )}
          <div id="flagQuizOptions" className={`grid gap-2 ${showNext ? 'fade-out' : ''}`}>
            {flagQuizOptions.map(option => (
              <button
                key={option.text}
                className={`quiz-option ${option.className || ''}`}
                onClick={() => checkAnswer(option.text)}
                disabled={option.disabled || isTransitioning}
              >
                {option.text}
              </button>
            ))}
          </div>
          <div className="flex gap-2 mt-2">
            {showNext && (
              <button
                id="nextFlagQuestion"
                className="w-full p-2 rounded-lg bg-[var(--button-bg)] text-[var(--button-text)] next-button"
                onClick={startFlagQuiz}
                disabled={isTransitioning}
              >
                {lang === 'ru' ? '–°–ª–µ–¥—É—é—â–∏–π' : 'Next'}
              </button>
            )}
            <button
              id="resetFlagQuiz"
              className="w-full p-2 rounded-lg bg-[var(--button-bg)] text-[var(--button-text)]"
              onClick={() => {
                setFlagCorrectAnswers(0);
                setFlagIncorrectAnswers(0);
                localStorage.setItem('flagCorrectAnswers', 0);
                localStorage.setItem('flagIncorrectAnswers', 0);
                startFlagQuiz();
              }}
            >
              {lang === 'ru' ? '–°–±—Ä–æ—Å–∏—Ç—å' : 'Reset'}
            </button>
          </div>
        </div>
      );
    };

    const CountriesComponent = ({ onBack }) => {
      const tg = window.Telegram?.WebApp;
      const [lang, setLang] = useState(localStorage.getItem('language') || 'ru');
      const [activeTab, setActiveTab] = useState(localStorage.getItem('activeTab') || 'search');
      const [countryInput, setCountryInput] = useState('');
      const [suggestions, setSuggestions] = useState([]);
      const [result, setResult] = useState(null);
      const [countryInfo, setCountryInfo] = useState(null);
      const [correctAnswers, setCorrectAnswers] = useState(parseInt(localStorage.getItem('correctAnswers')) || 0);
      const [incorrectAnswers, setIncorrectAnswers] = useState(parseInt(localStorage.getItem('incorrectAnswers')) || 0);
      const [flagCorrectAnswers, setFlagCorrectAnswers] = useState(parseInt(localStorage.getItem('flagCorrectAnswers')) || 0);
      const [flagIncorrectAnswers, setFlagIncorrectAnswers] = useState(parseInt(localStorage.getItem('flagIncorrectAnswers')) || 0);

      const updateTheme = () => {
        if (!tg?.themeParams) {
          return;
        }
        const themeParams = tg.themeParams;
        document.documentElement.style.setProperty('--input-bg', themeParams.secondary_bg_color || '#ffffff');
        document.documentElement.style.setProperty('--input-border', themeParams.hint_color || '#d1d5db');
        document.documentElement.style.setProperty('--button-bg', themeParams.button_color || '#3390ec');
        document.documentElement.style.setProperty('--button-text', themeParams.button_text_color || '#ffffff');
        document.documentElement.style.setProperty('--button-hover', themeParams.button_color ? (themeParams.button_color + 'cc') : '#2563eb');
        document.documentElement.style.setProperty('--suggestions-bg', themeParams.secondary_bg_color || '#ffffff');
        document.documentElement.style.setProperty('--suggestions-border', themeParams.hint_color || '#d1d5db');
        document.documentElement.style.setProperty('--suggestions-hover', themeParams.hint_color ? (themeParams.hint_color + '33') : '#f3f4f6');
        document.documentElement.style.setProperty('--theme-button-bg', themeParams.secondary_bg_color || '#e5e7eb');
        document.documentElement.style.setProperty('--theme-button-text', themeParams.text_color || '#374151');
        document.documentElement.style.setProperty('--error-text', themeParams.destructive_text_color || '#ef4444');
        document.documentElement.style.setProperty('--success-text', themeParams.accent_text_color || '#10b981');
        document.documentElement.style.setProperty('--quiz-button-bg', themeParams.button_color || '#3390ec');
        document.documentElement.style.setProperty('--quiz-button-hover', themeParams.button_color ? (themeParams.button_color + 'cc') : '#2563eb');
        document.documentElement.style.setProperty('--quiz-button-active', themeParams.button_color ? (themeParams.button_color + '99') : '#1e40af');
        document.documentElement.style.setProperty('--quiz-correct-bg', themeParams.accent_text_color || '#10b981');
        document.documentElement.style.setProperty('--quiz-incorrect-bg', themeParams.destructive_text_color || '#ef4444');
      };

      useEffect(() => {
        updateTheme();
        if (tg) {
          tg.onEvent('themeChanged', updateTheme);
          return () => tg.offEvent('themeChanged', updateTheme);
        }
      }, []);

      const toggleLanguage = () => {
        try {
          const newLang = lang === 'en' ? 'ru' : 'en';
          setLang(newLang);
          localStorage.setItem('language', newLang);
          setCorrectAnswers(0);
          setIncorrectAnswers(0);
          setFlagCorrectAnswers(0);
          setFlagIncorrectAnswers(0);
          localStorage.setItem('correctAnswers', 0);
          localStorage.setItem('incorrectAnswers', 0);
          localStorage.setItem('flagCorrectAnswers', 0);
          localStorage.setItem('flagIncorrectAnswers', 0);
          setCountryInput('');
          setResult(null);
          setCountryInfo(null);
          setSuggestions([]);
          if (tg?.showAlert) {
            tg.showAlert(`Language: ${newLang === 'ru' ? '–†—É—Å—Å–∫–∏–π' : 'English'}`);
          } else {
            alert(`Language: ${newLang === 'ru' ? '–†—É—Å—Å–∫–∏–π' : 'English'}`);
          }
        } catch (error) {
          console.error('Error in toggleLanguage:', error);
          if (tg?.showAlert) {
            tg.showAlert('Error changing language');
          } else {
            alert('Error changing language');
          }
        }
      };

      return (
        <div className="countries-content show" style={{ backgroundColor: window.Telegram?.WebApp?.themeParams.bg_color || '#e2e8f0' }}>
          <div className="countries-top-strip" style={{ backgroundColor: window.Telegram?.WebApp?.themeParams.bg_color || '#e2e8f0' }}></div>
          <ErrorBoundary>
            <div className="w-full max-w-sm p-4">
              <div className="flex justify-between items-center mb-2">
                <h1 className="text-2xl font-semibold animate-pulse" style={{ color: window.Telegram?.WebApp?.themeParams.text_color || '#1f2937' }}>
                  {lang === 'ru' ? '–°—Ç–æ–ª–∏—Ü—ã —Å—Ç—Ä–∞–Ω' : 'Country Capitals'}
                </h1>
                <button
                  id="langToggle"
                  className="p-2 rounded-full bg-[var(--theme-button-bg)] text-[var(--theme-button-text)]"
                  onClick={toggleLanguage}
                >
                  {lang === 'ru' ? 'üá∑üá∫' : 'üá¨üáß'}
                </button>
              </div>
              <nav className="flex gap-2 mb-2">
                <button
                  className={`tab ${activeTab === 'search' ? 'active' : ''}`}
                  onClick={() => { setActiveTab('search'); localStorage.setItem('activeTab', 'search'); }}
                >
                  {lang === 'ru' ? '–ü–æ–∏—Å–∫' : 'Search'}
                </button>
                <button
                  className={`tab ${activeTab === 'quiz' ? 'active' : ''}`}
                  onClick={() => { setActiveTab('quiz'); localStorage.setItem('activeTab', 'quiz'); }}
                >
                  {lang === 'ru' ? '–í–∏–∫—Ç–æ—Ä–∏–Ω–∞' : 'Quiz'}
                </button>
                <button
                  className={`tab ${activeTab === 'flagQuiz' ? 'active' : ''}`}
                  onClick={() => { setActiveTab('flagQuiz'); localStorage.setItem('activeTab', 'flagQuiz'); }}
                >
                  {lang === 'ru' ? '–§–ª–∞–≥–∏' : 'Flags'}
                </button>
              </nav>
              {activeTab === 'search' && (
                <SearchTab
                  lang={lang}
                  result={result}
                  setResult={setResult}
                  countryInfo={countryInfo}
                  setCountryInfo={setCountryInfo}
                  countryInput={countryInput}
                  setCountryInput={setCountryInput}
                  suggestions={suggestions}
                  setSuggestions={setSuggestions}
                />
              )}
              {activeTab === 'quiz' && (
                <QuizTab
                  lang={lang}
                  correctAnswers={correctAnswers}
                  incorrectAnswers={incorrectAnswers}
                  setCorrectAnswers={setCorrectAnswers}
                  setIncorrectAnswers={setIncorrectAnswers}
                />
              )}
              {activeTab === 'flagQuiz' && (
                <FlagQuizTab
                  lang={lang}
                  flagCorrectAnswers={flagCorrectAnswers}
                  flagIncorrectAnswers={flagIncorrectAnswers}
                  setFlagCorrectAnswers={setFlagCorrectAnswers}
                  setFlagIncorrectAnswers={setFlagIncorrectAnswers}
                />
              )}
            </div>
          </ErrorBoundary>
          <div className="countries-button-container">
            <button
              onClick={onBack}
              className="countries-back-button"
              style={{
                backgroundColor: window.Telegram?.WebApp?.themeParams.button_color || '#d1d5db',
                color: window.Telegram?.WebApp?.themeParams.button_text_color || '#1f2937',
              }}
            >
              –ù–∞–∑–∞–¥
            </button>
          </div>
          <div className="countries-bottom-strip" style={{ backgroundColor: window.Telegram?.WebApp?.themeParams.bg_color || '#e2e8f0' }}></div>
        </div>
      );
    };

    const QuotesComponent = ({ onBack }) => {
      const [quotes, setQuotes] = useState([{ text: "–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —Ü–∏—Ç–∞—Ç—É.", author: "‚Äî –ê–≤—Ç–æ—Ä" }]);
      const [currentIndex, setCurrentIndex] = useState(0);
      const [isLoading, setIsLoading] = useState(false);
      const [error, setError] = useState(false);
      const maxQuotes = 5;

      useEffect(() => {
        getRandomQuote();
      }, []);

      const getRandomQuote = () => {
        setIsLoading(true);
        setError(false);
        $.ajax({
          url: 'https://api.forismatic.com/api/1.0/',
          jsonp: 'jsonp',
          dataType: 'jsonp',
          data: {
            method: 'getQuote',
            lang: 'ru',
            format: 'jsonp'
          },
          success: function(response) {
            const quote = response.quoteText;
            const author = response.quoteAuthor || '–ê–Ω–æ–Ω–∏–º';
            setQuotes(prev => {
              const newQuotes = [...prev, { text: quote, author }];
              if (newQuotes.length > maxQuotes) newQuotes.shift();
              setCurrentIndex(newQuotes.length - 1);
              return newQuotes;
            });
          },
          error: function() {
            setError(true);
          },
          complete: function() {
            setIsLoading(false);
          }
        });
      };

      const handlePrevQuote = () => {
        if (currentIndex > 0) {
          setCurrentIndex(currentIndex - 1);
        }
      };

      return (
        <div className={`quote-content ${quotes[currentIndex] ? 'show' : ''}`} style={{ backgroundColor: window.Telegram?.WebApp?.themeParams.bg_color || '#e2e8f0' }}>
          <div className="quote-top-strip" style={{ backgroundColor: window.Telegram?.WebApp?.themeParams.bg_color || '#e2e8f0' }}></div>
          <div className="p-6 rounded-xl shadow-lg max-w-lg w-full text-center" style={{ backgroundColor: window.Telegram?.WebApp?.themeParams.secondary_bg_color || '#ffffff', color: window.Telegram?.WebApp?.themeParams.text_color || '#1f2937' }}>
            <h1 className="text-2xl font-semibold mb-4">–°–ª—É—á–∞–π–Ω—ã–µ —Ü–∏—Ç–∞—Ç—ã</h1>
            <div className="space-y-4">
              {quotes[currentIndex] && (
                <div className="quote-slide">
                  <p className="text-lg italic">"{quotes[currentIndex].text}"</p>
                  <p className="text-sm font-medium" style={{ color: window.Telegram?.WebApp?.themeParams.hint_color || '#6b7280' }}>{quotes[currentIndex].author}</p>
                </div>
              )}
            </div>
            <div className="flex justify-between mt-6">
              <button
                onClick={handlePrevQuote}
                className="prev-quote-button px-4 py-2 rounded-lg transition disabled:opacity-50"
                disabled={currentIndex === 0}
                style={{ backgroundColor: window.Telegram?.WebApp?.themeParams.secondary_bg_color || '#e5e7eb', color: window.Telegram?.WebApp?.themeParams.text_color || '#1f2937' }}
              >
                –ü—Ä–µ–¥—ã–¥—É—â–∞—è
              </button>
              <button
                onClick={getRandomQuote}
                className="quote-button text-white px-4 py-2 rounded-lg transition flex items-center"
                disabled={isLoading}
                style={{ backgroundColor: window.Telegram?.WebApp?.themeParams.button_color || '#3b82f6', color: window.Telegram?.WebApp?.themeParams.button_text_color || '#ffffff' }}
              >
                <span>{isLoading ? '–ó–∞–≥—Ä—É–∑–∫–∞...' : '–ù–æ–≤–∞—è —Ü–∏—Ç–∞—Ç–∞'}</span>
                {isLoading && (
                  <svg className="w-5 h-5 ml-2 spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 12a8 8 0 0116 0 8 8 0 01-16 0z" />
                  </svg>
                )}
              </button>
            </div>
            {error && <p className="text-red-500 text-sm mt-4">–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ü–∏—Ç–∞—Ç—É. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.</p>}
          </div>
          <div className="quote-button-container">
            <button
              onClick={onBack}
              className="quote-back-button"
              style={{
                backgroundColor: window.Telegram?.WebApp?.themeParams.button_color || '#d1d5db',
                color: window.Telegram?.WebApp?.themeParams.button_text_color || '#1f2937',
              }}
            >
              –ù–∞–∑–∞–¥
            </button>
          </div>
          <div className="quote-bottom-strip" style={{ backgroundColor: window.Telegram?.WebApp?.themeParams.bg_color || '#e2e8f0' }}></div>
        </div>
      );
    };

    const App = () => {
      const [showCatContent, setShowCatContent] = useState(false);
      const [showQuoteContent, setShowQuoteContent] = useState(false);
      const [showCountriesContent, setShowCountriesContent] = useState(false);
      const [visibleButtons, setVisibleButtons] = useState([]);
      const [catImage, setCatImage] = useState('');
      const [catFact, setCatFact] = useState('');
      const [isCatContentVisible, setIsCatContentVisible] = useState(false);

      useEffect(() => {
        if (window.Telegram?.WebApp) {
          window.Telegram.WebApp.ready();
          window.Telegram.WebApp.expand();
          updateTheme();
          window.Telegram.WebApp.onEvent('themeChanged', updateTheme);
        }
        buttons.forEach((_, index) => {
          setTimeout(() => {
            setVisibleButtons((prev) => [...prev, index]);
          }, index * 400);
        });
      }, []);

      const updateTheme = () => {
        const bgColor = window.Telegram.WebApp.themeParams.bg_color || '#e2e8f0';
        const textColor = window.Telegram.WebApp.themeParams.text_color || '#1f2937';
        const buttonColor = window.Telegram.WebApp.themeParams.button_color || '#d1d5db';
        const buttonTextColor = window.Telegram.WebApp.themeParams.button_text_color || '#1f2937';
        const secondaryBgColor = window.Telegram.WebApp.themeParams.secondary_bg_color || '#f1f5f9';
        const hintColor = window.Telegram.WebApp.themeParams.hint_color || '#6b7280';

        document.body.style.backgroundColor = bgColor;
        document.body.style.color = textColor;
        document.documentElement.style.setProperty('--text-color', textColor);
        const catContent = document.querySelector('.cat-content');
        if (catContent) {
          catContent.style.backgroundColor = bgColor;
        }
        const quoteContent = document.querySelector('.quote-content');
        if (quoteContent) {
          quoteContent.style.backgroundColor = bgColor;
        }
        const countriesContent = document.querySelector('.countries-content');
        if (countriesContent) {
          countriesContent.style.backgroundColor = bgColor;
        }
        const strips = document.querySelectorAll('.cat-top-strip, .cat-bottom-strip, .quote-top-strip, .quote-bottom-strip, .countries-top-strip, .countries-bottom-strip');
        strips.forEach(strip => {
          strip.style.backgroundColor = bgColor;
        });
      };

      const fetchCatContent = async () => {
        try {
          const imageResponse = await fetch('https://api.thecatapi.com/v1/images/search?mime_types=jpg,png');
          if (!imageResponse.ok) throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è');
          const imageData = await imageResponse.json();
          setCatImage(imageData[0].url);
          const randomFact = catFacts[Math.floor(Math.random() * catFacts.length)];
          setCatFact(randomFact);
          setIsCatContentVisible(false);
          setTimeout(() => setIsCatContentVisible(true), 10);
        } catch (error) {
          console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ—Ç–∏–∫–∞:', error.message);
          setCatFact('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞!');
          setCatImage('');
          setIsCatContentVisible(false);
          setTimeout(() => setIsCatContentVisible(true), 10);
        }
      };

      const handleCatButtonClick = () => {
        setShowCatContent(true);
        setShowQuoteContent(false);
        setShowCountriesContent(false);
        fetchCatContent();
        if (window.Telegram?.WebApp) {
          window.Telegram.WebApp.HapticFeedback.impactOccurred('medium');
        }
      };

      const handleQuoteButtonClick = () => {
        setShowQuoteContent(true);
        setShowCatContent(false);
        setShowCountriesContent(false);
        if (window.Telegram?.WebApp) {
          window.Telegram.WebApp.HapticFeedback.impactOccurred('medium');
        }
      };

      const handleCountriesButtonClick = () => {
        setShowCountriesContent(true);
        setShowCatContent(false);
        setShowQuoteContent(false);
        if (window.Telegram?.WebApp) {
          window.Telegram.WebApp.HapticFeedback.impactOccurred('medium');
        }
      };

      const handleBack = () => {
        setShowCatContent(false);
        setShowQuoteContent(false);
        setShowCountriesContent(false);
        setCatImage('');
        setCatFact('');
      };

      return (
        <div className="min-h-screen flex flex-col items-center justify-center p-4 relative transition-colors duration-500">
          {!showCatContent && !showQuoteContent && !showCountriesContent && (
            <>
              <h1
                className="text-4xl font-bold mb-8 animate-[fadeIn_1s_ease-out_forwards]"
                style={{ color: window.Telegram?.WebApp?.themeParams.hint_color || '#6b7280' }}
              >
                N
              </h1>
              <div className="space-y-4 w-full max-w-xs">
                {buttons.map((button, index) => visibleButtons.includes(index) && (
                  <button
                    key={button.name}
                    onClick={
                      button.name === "–¶–∏—Ç–∞—Ç—ã" ? handleQuoteButtonClick :
                      button.name === "–ö–æ—Ç–∏–∫–∏" ? handleCatButtonClick :
                      button.name === "–°—Ç—Ä–∞–Ω—ã" ? handleCountriesButtonClick :
                      button.url ? () => window.open(button.url, '_blank', 'noopener,noreferrer') : null
                    }
                    className="block w-full py-3 px-6 text-center rounded-lg font-semibold text-lg shadow-lg transition-all duration-300 hover:scale-105 active:scale-95"
                    style={{
                      backgroundColor: window.Telegram?.WebApp?.themeParams.button_color || '#d1d5db',
                      color: window.Telegram?.WebApp?.themeParams.button_text_color || '#1f2937',
                    }}
                  >
                    {button.name}
                  </button>
                ))}
              </div>
              <button
                onClick={() => window.Telegram?.WebApp?.openTelegramLink('https://t.me/nkego')}
                className="telegram-link hover:scale-110 active:scale-90"
                style={{
                  color: window.Telegram?.WebApp?.themeParams.button_text_color || '#1f2937',
                }}
              >
                N
              </button>
            </>
          )}
          {showCatContent && (
            <div className={`cat-content ${isCatContentVisible ? 'show' : ''}`} style={{ backgroundColor: window.Telegram?.WebApp?.themeParams.bg_color || '#e2e8f0' }}>
              <div className="cat-top-strip" style={{ backgroundColor: window.Telegram?.WebApp?.themeParams.bg_color || '#e2e8f0' }}></div>
              <img src={catImage} alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–æ—Ç–∏–∫–∞" className="cat-image" />
              <p className="cat-fact" style={{ color: window.Telegram?.WebApp?.themeParams.text_color || '#1f2937' }}>{catFact}</p>
              <div className="button-container">
                <button
                  onClick={fetchCatContent}
                  className="cat-button"
                  style={{
                    backgroundColor: window.Telegram?.WebApp?.themeParams.button_color || '#d1d5db',
                    color: window.Telegram?.WebApp?.themeParams.button_text_color || '#1f2937',
                  }}
                >
                  –ü–æ–∫–∞–∑–∞—Ç—å –∫–æ—Ç–∏–∫–∞!
                </button>
                <button
                  onClick={handleBack}
                  className="back-button"
                  style={{
                    backgroundColor: window.Telegram?.WebApp?.themeParams.button_color || '#d1d5db',
                    color: window.Telegram?.WebApp?.themeParams.button_text_color || '#1f2937',
                  }}
                >
                  –ù–∞–∑–∞–¥
                </button>
              </div>
              <div className="cat-bottom-strip" style={{ backgroundColor: window.Telegram?.WebApp?.themeParams.bg_color || '#e2e8f0' }}></div>
            </div>
          )}
          {showQuoteContent && (
            <QuotesComponent onBack={handleBack} />
          )}
          {showCountriesContent && (
            <CountriesComponent onBack={handleBack} />
          )}
        </div>
      );
    };

    try {
      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞:', error);
      document.getElementById('root').innerHTML = '<h1 style="color: red; text-align: center;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞.</h1>';
    }
  </script>
</body>
</html>
